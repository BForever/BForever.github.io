<h1 id="chaos错误管理">Chaos错误管理</h1>
<h2 id="错误类型">错误类型</h2>
<h3 id="错误操作">错误操作</h3>
<ul>
  <li>参数设置缺失</li>
  <li>参数设置错误</li>
</ul>

<h3 id="意外重启">意外重启</h3>
<ul>
  <li>在ifb初始化过程中意外退出（全局，执行一次）</li>
  <li>在网卡转发规则设置过程中意外退出（单Pod，执行一次）</li>
  <li>在netem设置过程中意外退出（全局，执行多次）</li>
</ul>

<h2 id="解决方案">解决方案</h2>
<h3 id="错误操作-1">错误操作</h3>
<ul>
  <li>参数设置缺失</li>
</ul>

<p>设置前检查参数，为空时按清空设置处理</p>

<ul>
  <li>参数设置错误</li>
</ul>

<p>TC返回错误时，清空设置，产生错误日志，在done标志上标记”error”</p>

<h3 id="意外重启-1">意外重启</h3>
<p>首先整理重启后仍然存在的设置：</p>

<ol>
  <li>ifb本身</li>
  <li>各个Pod网卡的转发规则</li>
  <li>ifb上各个Pod的设置</li>
</ol>

<ul>
  <li>在ifb初始化过程中意外退出（全局，执行一次）</li>
</ul>

<p>启动时检测ifb是否已经工作，如果是，则不再初始化ifb</p>

<ul>
  <li>在网卡转发规则设置过程中意外退出（单Pod，执行一次）</li>
</ul>

<p>在每次netem设置前检查转发规则，若规则有误，则重置转发规则</p>

<ul>
  <li>在netem设置过程中意外退出（全局，执行多次）</li>
</ul>

<p>不需要额外处理，因为更新标志未被覆盖，因此下次重启会再次设置</p>
