<h2 id="在集群中安装influxdb">在集群中安装influxdb</h2>
<p>influxdb提供了官方镜像，因此在集群中安装influxdb十分方便，只需要指定镜像名为influxdb即可自动下载运行，只需要配置环境变量就可以进行初始化设置</p>

<p>以下是官方文档提供的可配置环境变量</p>
<h4 id="influxdb_db"><code class="highlighter-rouge">INFLUXDB_DB</code></h4>
<p>以这个环境变量作为名字自动初始化一个数据库</p>

<h4 id="influxdb_http_auth_enabled"><code class="highlighter-rouge">INFLUXDB_HTTP_AUTH_ENABLED</code></h4>
<p>允许身份验证。必须设置此选项或必须在配置文件中设置<code class="highlighter-rouge">auth-enabled = true</code>才能使后续的任何身份验证相关选项生效。</p>

<h4 id="influxdb_admin_user"><code class="highlighter-rouge">INFLUXDB_ADMIN_USER</code></h4>
<p>以这个环境变量作为名字自动初始化一个管理员用户</p>

<h4 id="influxdb_admin_password"><code class="highlighter-rouge">INFLUXDB_ADMIN_PASSWORD</code></h4>
<p>以这个环境变量作为管理员用户的密码</p>

<h4 id="influxdb_user"><code class="highlighter-rouge">INFLUXDB_USER</code></h4>
<p>以这个环境变量作为名字自动初始化一个普通用户，如果初始化了数据库，则自动获得该数据库的读写权限</p>

<h4 id="influxdb_user_password"><code class="highlighter-rouge">INFLUXDB_USER_PASSWORD</code></h4>
<p>使用INFLUXDB_USER配置的用户的密码。如果未设置，则生成随机密码并打印到标准输出。</p>

<h4 id="influxdb_read_user"><code class="highlighter-rouge">INFLUXDB_READ_USER</code></h4>
<p>要在<code class="highlighter-rouge">INFLUXDB_DB</code>上使用读取权限创建的用户的名称。如果未设置<code class="highlighter-rouge">INFLUXDB_DB</code>，则此用户将没有授予权限。</p>

<p>####<code class="highlighter-rouge">INFLUXDB_READ_USER_PASSWORD</code>
使用<code class="highlighter-rouge">INFLUXDB_READ_USER</code>配置的用户的密码。如果未设置，则生成随机密码并打印到标准输出。</p>

<p>####<code class="highlighter-rouge">INFLUXDB_WRITE_USER</code>
要在<code class="highlighter-rouge">INFLUXDB_DB</code>上使用写权限创建的用户的名称。如果未设置<code class="highlighter-rouge">INFLUXDB_DB</code>，则此用户将没有授予权限。</p>

<p>####<code class="highlighter-rouge">INFLUXDB_WRITE_USER_PASSWORD</code>
使用<code class="highlighter-rouge">INFLUXDB_WRITE_USER</code>配置的用户的密码。如果未设置，则生成随机密码并打印到标准输出。</p>

<h2 id="使用http-api与数据库通信">使用HTTP API与数据库通信</h2>
<p>influxDB自带HTTP接口，可以轻松编写代码读写数据库</p>

<p>首先观察<a href="https://docs.influxdata.com/influxdb/v1.6/guides/writing_data/">官方文档</a>中使用curl操作数据库的样例：</p>

<h4 id="create-your-first-database">Create your first database</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST "http://localhost:8086/query" --data-urlencode "q=CREATE DATABASE mydb"
</code></pre></div></div>

<h4 id="insert-some-data">Insert some data</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -XPOST "http://localhost:8086/write?db=mydb" \
-d 'cpu,host=server01,region=uswest load=42 1434055562000000000'

curl -XPOST "http://localhost:8086/write?db=mydb" \
-d 'cpu,host=server02,region=uswest load=78 1434055562000000000'

curl -XPOST "http://localhost:8086/write?db=mydb" \
-d 'cpu,host=server03,region=useast load=15.4 1434055562000000000'
</code></pre></div></div>

<h4 id="query-for-the-data">Query for the data</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -G "http://localhost:8086/query?pretty=true" --data-urlencode "db=mydb" \
--data-urlencode "q=SELECT * FROM cpu WHERE host='server01' AND time &lt; now() - 1d"
</code></pre></div></div>

<h4 id="analyze-the-data">Analyze the data</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -G "http://localhost:8086/query?pretty=true" --data-urlencode "db=mydb" \
--data-urlencode "q=SELECT mean(load) FROM cpu WHERE region='uswest'"
</code></pre></div></div>

<p>看起来有一些麻烦，但是influxDB官方同时给出了HTTP client代码库</p>

<h1 id="使用go-client">使用GO Client</h1>
<h2 id="连接客户端">连接客户端</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c, err := client_v2.NewHTTPClient(client_v2.HTTPConfig{
		Addr:     "http://192.168.102.238:8086",
		Username: "kubespy",
		Password: "kubespy",
	})
	if err != nil {
		log.Fatal(err)
	}
	defer c.Close()
</code></pre></div></div>
